<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daydreamin'</title>
    
    <!-- IMPORTING THE NEW RETRO FONT -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

    <style>
        /* --- Global, Background, and NEW FONT --- */
        body {
            font-family: 'Press Start 2P', monospace;
            font-size: 10px;
            color: #111;
            background-color: #A3D5FF;
            background-image: 
                linear-gradient(45deg, #F7D9E3 25%, transparent 25%), 
                linear-gradient(-45deg, #F7D9E3 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #F7D9E3 75%),
                linear-gradient(-45deg, transparent 75%, #F7D9E3 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            
            margin: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' style='font-size:10px;'><path d='M0,0 L0,28 L21,14 Z' style='fill:%23111;stroke:%23fff;stroke-width:1.5px;'/></svg>") 0 0, auto;
            touch-action: none;
        }

        /* --- CSS-ONLY PIXEL STARFIELD --- */
        .stars {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background-repeat: repeat;
            animation: shine-and-move linear infinite;
        }
        #stars1 { background-image: radial-gradient(1px 1px at 20px 30px, #fff, transparent), radial-gradient(1px 1px at 50px 80px, #fff, transparent); background-size: 200px 200px; animation-duration: 200s; }
        #stars2 { background-image: radial-gradient(1px 1px at 40px 60px, #fff, transparent), radial-gradient(1px 1px at 120px 150px, #fff, transparent); background-size: 300px 300px; animation-duration: 150s; }
        #stars3 { background-image: radial-gradient(2px 2px at 80px 40px, #fff, transparent), radial-gradient(2px 2px at 160px 120px, #fff, transparent); background-size: 250px 250px; animation-duration: 100s; }
        @keyframes shine-and-move { from { background-position: 0 0; opacity: 0.8; } 50% { opacity: 1; } to { background-position: -10000px 5000px; opacity: 0.8; } }

        /* --- Screen Wrappers --- */
        #entry-wrapper { display: flex; align-items: center; justify-content: center; height: 100%; }
        #desktop-wrapper { display: none; height: 100%; width: 100%; }
        
        /* --- ENHANCED TASKBAR --- */
        .taskbar {
            position: fixed; bottom: 0; left: 0; right: 0; height: 36px;
            background-color: #EAEAEA; border-top: 2px solid #111;
            padding: 0 5px; display: flex; align-items: center; z-index: 5000; gap: 6px;
        }
        .start-button {
            padding: 4px 12px; font-weight: bold; border: 2px solid #111; background: #FFB3C1;
            color: #111; border-radius: 6px; box-shadow: 3px 3px 0 #111;
            transition: all 0.1s ease-out; font-size: 10px;
        }
        .start-button:hover { transform: translate(1px, 1px); box-shadow: 2px 2px 0 #111; }
        .start-button:active { transform: translate(3px, 3px); box-shadow: 0 0 0 #111; }
        #taskbar-windows { display: flex; gap: 4px; height: 100%; align-items: center; }
        .taskbar-tab {
            display: flex; align-items: center; justify-content: center;
            height: 28px; width: 32px; padding: 0; border: 2px solid #111;
            background: #EAEAEA; color: #111;
            border-radius: 6px; box-shadow: 2px 2px 0 #111; font-size: 10px;
            overflow: hidden;
        }
        .taskbar-tab .icon-visual, .taskbar-tab .icon-visual img {
            width: 22px;
            height: 22px;
            object-fit: contain;
        }
        .taskbar-tab.active { background: #DCDCDC; box-shadow: inset 2px 2px 0 #11111188; border-style: solid; }
        .clock {
            margin-left: auto; padding: 4px 8px;
            background: #111; color: #9BF6FF;
            border: 2px solid #111; border-radius: 4px;
            box-shadow: inset 2px 2px 0 #00000088; font-size: 10px;
        }

        /* --- WINDOWS: New Chunky, Drawn Style --- */
        .window {
            background: #EAEAEA; border: 2px solid #111;
            box-shadow: 6px 6px 0px #111; border-radius: 8px;
            padding: 3px; position: absolute;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 90%; max-width: 400px;
            display: none; z-index: 1000;
            animation: openWindow 0.3s ease-out;
        }
        @keyframes openWindow { from { transform: translate(-50%, -50%) scale(0.5); opacity: 0; } to { transform: translate(-50%, -50%) scale(1); opacity: 1; } }
        
        #password-window { display: block; }
        .title-bar { 
            background: transparent; color: #111; padding: 5px 8px; 
            display: flex; justify-content: space-between; align-items: center; 
            font-weight: normal; user-select: none; border-bottom: 2px solid #111;
            font-size: 10px;
        }
        .title-bar-controls { display: flex; gap: 5px; }
        .title-bar-controls button {
             width: 14px; height: 14px; min-height: 14px; 
             background-color: transparent; border: 2px solid #111;
             border-radius: 50%; padding: 0;
        }
        .close-button::before { display: none; }
        .window-body { 
            background-color: #F0F0F0; color: #111;
            padding: 10px 20px; margin: 3px;
            border: none; box-shadow: inset 1px 1px 2px #00000022;
            max-height: 60vh; overflow-y: auto; line-height: 1.8;
        }
        .window-body p { margin: 1.5em 0; }

        .window-body::-webkit-scrollbar { width: 16px; }
        .window-body::-webkit-scrollbar-track { background: #DCDCDC; border-left: 2px solid #111; }
        .window-body::-webkit-scrollbar-thumb { background-color: #B0B0B0; border: 2px solid #111; border-radius: 4px; }

        /* --- Entry Screen & Action Buttons --- */
        .riddle { margin-top: 0; line-height: 1.8; }
        #password-form input[type="text"] { 
            width: calc(100% - 20px); padding: 8px 10px; margin-bottom: 10px; 
            border: 2px solid #111; font-family: 'Press Start 2P', monospace; 
            font-size: 10px; background: #fff;
        }
        .action-button {
            padding: 10px 20px; font-family: 'Press Start 2P', monospace; font-size: 10px;
            background: #EAEAEA; border: 3px outset #111; box-shadow: 4px 4px 0 #111;
            transition: all 0.1s ease-out;
        }
        .action-button:hover { background: #f5f5f5; }
        .action-button:active { border-style: inset; transform: translate(4px, 4px); box-shadow: none; }
        .error-message { color: #FF3B30; margin-bottom: 10px; font-weight: bold; display: none; }

        /* --- Container for Draggable Icons --- */
        #desktop-icons-container {
            position: absolute; top: 0; left: 0;
            width: 100%; height: calc(100% - 36px); z-index: 1;
        }

        /* --- DRAGGABLE & FLOATING ICONS --- */
        .desktop-icon {
            position: absolute; width: 90px; text-align: center;
            animation-iteration-count: infinite; animation-timing-function: ease-in-out;
            animation-direction: alternate; user-select: none;
        }
        .desktop-icon.dragging { animation-play-state: paused; z-index: 100; transform: scale(1.1); }
        
        @keyframes float1 { from { transform: translate(0, 0); } to { transform: translate(15px, 20px); } }
        @keyframes float2 { from { transform: translate(0, 0); } to { transform: translate(-18px, 12px); } }
        @keyframes float3 { from { transform: translate(0, 0); } to { transform: translate(12px, -15px) rotate(8deg); } }
        @keyframes float4 { from { transform: translate(0, 0); } to { transform: translate(-10px, -18px) rotate(-8deg); } }
        @keyframes float5 { 0% { transform: translateY(5px); } 25% { transform: translateX(-5px); } 50% { transform: translateY(-5px); } 75% { transform: translateX(5px); } 100% { transform: translateY(5px); } }
        @keyframes float6 { from { transform: scale(1); } to { transform: scale(1.05); } }

        .desktop-icon:hover { background: rgba(163, 213, 255, 0.7); border-radius: 8px; }
        .desktop-icon .icon-visual {
            height: 40px; 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .desktop-icon .icon-visual img {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }
        .desktop-icon .icon-label {
            margin-top: 8px; color: #333;
            text-shadow: 1px 1px 0px #fff;
            word-wrap: break-word; font-size: 10px; line-height: 1.4;
        }
        .desktop-icon:hover .icon-label { background: rgba(0, 0, 128, 0.7); color: #fff; text-shadow: none; border-radius: 4px; }
        
        .starlight-materialize { animation: starlight-materialize 1.5s cubic-bezier(0.19, 1, 0.22, 1) forwards; }
        @keyframes starlight-materialize { 0% { opacity: 0; transform: scale(0.5); filter: blur(10px) drop-shadow(0 0 20px #fff); } 60% { opacity: 1; filter: blur(2px) drop-shadow(0 0 10px #D4AF37); } 100% { opacity: 1; transform: scale(1); filter: blur(0) drop-shadow(0 0 0px transparent); } }

        /* --- Popups & Video --- */
        .memory-popup { max-width: 350px; }
        .popup-visual {
            text-align: center;
            margin-bottom: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding-top: 10px;
        }
        .popup-visual img {
            width: 96px;
            height: 96px;
            object-fit: contain;
        }
        .popup-text { line-height: 1.8; text-align: left; }

        /* --- ENHANCED FINAL POPUP & RETRO AUDIO CONTROLS --- */
        .final-popup-special { 
            width: 90%; max-width: 650px; 
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%); 
            border: 3px solid #FFB3C1; 
            box-shadow: 0 0 20px rgba(255, 179, 193, 0.3), 8px 8px 0px #111;
        }
        .final-popup-special .title-bar { 
            background: linear-gradient(90deg, #FFB3C1, #F7D9E3);
            color: #111; border-color: #111; 
            text-shadow: 1px 1px 0 rgba(255,255,255,0.3);
        }
        .final-popup-special .window-body { 
            background: linear-gradient(135deg, #111 0%, #1a1a1a 100%); 
            color: #EAEAEA; 
            border: 2px inset #333;
        }
        .final-popup-special .close-button { 
            border-color: #FFB3C1; 
            background: #FFB3C1;
        }
        
        #lyric-display {
            width: 100%; min-height: 100px; display: flex; justify-content: center;
            align-items: center; text-align: center; font-size: 20px;
            line-height: 1.7; color: #EAEAEA; margin-bottom: 25px;
            background: linear-gradient(45deg, #0a0a0a, #1a1a1a);
            border: 2px inset #333; border-radius: 8px; padding: 20px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }
        .lyric-line { 
            animation: fadeIn 0.5s forwards; 
            text-shadow: 0 0 5px rgba(255, 179, 193, 0.3);
        }
        @keyframes fadeIn { to { opacity: 1; } }

        /* --- ENHANCED RETRO AUDIO CONTROLS --- */
        #custom-audio-controls {
            display: flex; align-items: center; gap: 12px;
            width: 100%; padding: 15px; box-sizing: border-box;
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            border: 2px outset #444; border-radius: 10px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
        }

        #play-pause-button {
            font-family: 'Press Start 2P', monospace; font-size: 10px;
            width: 60px; height: 50px; 
            border: 3px outset #FFB3C1;
            background: linear-gradient(135deg, #FFB3C1 0%, #F7D9E3 100%);
            color: #111; border-radius: 8px;
            box-shadow: 3px 3px 0 #111, inset 0 0 5px rgba(255,255,255,0.2);
            transition: all 0.15s ease;
            text-shadow: 1px 1px 0 rgba(255,255,255,0.3);
        }
        #play-pause-button:hover {
            background: linear-gradient(135deg, #F7D9E3 0%, #FFB3C1 100%);
            transform: translate(1px, 1px);
            box-shadow: 2px 2px 0 #111, inset 0 0 5px rgba(255,255,255,0.2);
        }
        #play-pause-button:active {
            transform: translate(3px, 3px);
            box-shadow: 0 0 0 #111, inset 2px 2px 5px rgba(0,0,0,0.3);
        }
        #play-pause-button.playing { 
            border-style: inset; 
            background: linear-gradient(135deg, #9BF6FF 0%, #A3D5FF 100%);
            color: #111;
        }

        .time-display {
            background: linear-gradient(135deg, #111 0%, #000 100%); 
            color: #9BF6FF; padding: 8px 12px;
            font-size: 10px; 
            border: 2px inset #000; border-radius: 6px;
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.5);
            text-shadow: 0 0 3px rgba(155, 246, 255, 0.5);
            font-weight: bold;
        }

        .progress-bar {
            flex-grow: 1; height: 24px; 
            background: linear-gradient(135deg, #000 0%, #111 100%);
            border: 2px inset #000; cursor: pointer; border-radius: 6px;
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.7);
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%; width: 0%; 
            background: linear-gradient(90deg, #FFB3C1 0%, #F7D9E3 50%, #9BF6FF 100%);
            border-radius: 4px;
            box-shadow: 0 0 5px rgba(255, 179, 193, 0.5);
            transition: width 0.1s ease;
        }

        #soundcloud-player-container {
            position: absolute;
            left: -9999px; /* Hides the player off-screen */
        }

        /* --- Enhanced styling for password and birthday windows --- */
        .riddle em {
            color: #FF6B9D;
            font-style: normal;
            text-shadow: 1px 1px 0 rgba(255,255,255,0.3);
        }
        
        /* --- MOBILE ADAPTIVE BACKGROUND --- */
        @media (max-width: 600px) {
            body {
                background-size: 15px 15px;
                background-position: 0 0, 0 7.5px, 7.5px -7.5px, -7.5px 0px;
            }
        }

    </style>
</head>

<body>
    <div class="stars" id="stars1"></div>
    <div class="stars" id="stars2"></div>
    <div class="stars" id="stars3"></div>

    <div id="desktop-wrapper">
        <div id="desktop-icons-container"></div> 
        <div class="taskbar">
            <button class="start-button">Start</button>
            <div id="taskbar-windows"></div>
            <div class="clock" id="clock">12:00 PM</div>
        </div>
        <div class="window memory-popup" id="memory-popup-template" data-memory-id=""></div>
        <div class="window final-popup-special" id="final-popup"></div>
    </div>
    <div id="entry-wrapper">
        <div class="window" id="password-window"></div>
    </div>
    <div class="window" id="birthday-popup"></div>

    <script src="https://w.soundcloud.com/player/api.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Elements ---
        const entryWrapper = document.getElementById('entry-wrapper');
        const desktopWrapper = document.getElementById('desktop-wrapper');
        const passwordWindow = document.getElementById('password-window');
        const birthdayPopup = document.getElementById('birthday-popup');
        const memoryPopup = document.getElementById('memory-popup-template');
        const finalPopup = document.getElementById('final-popup');
        
        // All accepted password variations
        const validPasswords = [
            "daydream", "daydreaming", "daydreamin", "daydreamin'", 
            "daydreamy", "daydreamer", "daydreamers",
            "Daydream", "Daydreaming", "Daydreamin", "Daydreamin'", 
            "Daydreamy", "Daydreamer", "Daydreamers"
        ];
        
        function populateWindows() {
            passwordWindow.innerHTML = `<div class="title-bar"><div class="title-bar-text">Guess the password</div><div class="title-bar-controls"><button></button><button class="close-button"></button></div></div><div class="window-body"><div class="riddle"><p><em>What's the name of our universe?</em></p><p>It's where I hold your hand<br>before I ever touch it.<br><br>It's where I hear your voice<br>before you even speak.<br><br>It's where I see you,<br>even when my eyes are closed.<br><br>What is this place called?</p></div><form id="password-form"><input type="text" id="password-input" placeholder="Type it below if you know it." autofocus><div class="error-message" id="error-message">Not quite... but I like how you're thinking. Try again.</div><div style="text-align: right;"><button class="action-button" type="submit">Enter</button></div></form></div>`;
            
            birthdayPopup.innerHTML = `<div class="title-bar"><div class="title-bar-text">Happy Birthday 💕</div><div class="title-bar-controls"><button></button><button class="close-button"></button></div></div><div class="window-body"><p>Happy Birthday, my daydream.</p><p>Today is our birthday.<br>It’s the day when you and my soul were born.<br><br>I never knew how to wrap feelings<br>so I built this instead.</p><p>You don't just make me feel loved.<br>You make me feel understood.</p><p>I called this our universe<br>because that's where you live<br>in the space between my thoughts,<br>in the quiet I don't share with anyone.</p><p><strong>Daydreaming</strong><br>it's not something I do.<br>It's where I find you.</p><p>You made my life feel like a movie.<br>Not perfect. Just alive.<br>Just real.</p><p>Happy birthday, love.</p><p>Let's keep dreaming.<br>Let's keep being real inside our fiction.<br><br><br>– Amine</p><div style="text-align:center; margin-top: 20px;"><button class="action-button" id="enter-universe-button">I made something beautiful for you.</button></div></div>`;
            
            memoryPopup.innerHTML = `<div class="title-bar"><div class="title-bar-text" id="popup-title"></div><div class="title-bar-controls"><button></button><button class="close-button"></button></div></div><div class="window-body"><div class="popup-visual"></div><div class="popup-text" id="popup-text"></div></div>`;
            
            finalPopup.innerHTML = `<div class="title-bar"><div class="title-bar-text">You've unlocked something special.</div><div class="title-bar-controls"><button></button><button class="close-button"></button></div></div><div class="window-body"><div id="lyric-display"></div><div id="custom-audio-controls"><button id="play-pause-button">►</button><span id="current-time" class="time-display">0:00</span><div class="progress-bar"><div class="progress-bar-fill"></div></div><span id="total-duration" class="time-display">0:00</span></div><div id="soundcloud-player-container"></div></div>`;
        }
        
        populateWindows();

        const form = document.getElementById('password-form');
        const passwordInput = document.getElementById('password-input');
        const errorMessage = document.getElementById('error-message');
        
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const userInput = passwordInput.value.trim().toLowerCase().replace(/'/g, "");
            const isValid = validPasswords.some(password => 
                userInput === password.replace(/'/g, "")
            );
            
            if (isValid) {
                passwordWindow.style.display = 'none';
                birthdayPopup.style.display = 'block';
            } else {
                errorMessage.style.display = 'block';
                passwordInput.value = '';
            }
        });
        
        function enterTheUniverse() {
            birthdayPopup.style.display = 'none';
            entryWrapper.style.display = 'none';
            desktopWrapper.style.display = 'block';
            initializeDesktop();
        }

        birthdayPopup.querySelector('.close-button').addEventListener('click', enterTheUniverse);
        document.getElementById('enter-universe-button').addEventListener('click', enterTheUniverse);
        
        // --- MODIFIED CLICK LISTENER ---
        document.addEventListener('click', (event) => {
            if (desktopWrapper.style.display !== 'block') return;
            const isInteractive = event.target.closest('.window') || event.target.closest('.desktop-icon') || event.target.closest('.taskbar');
            if (!isInteractive) {
                // Check if the final memory window is open. If so, don't close it automatically.
                const isLastMemoryOpen = memoryPopup.style.display === 'block' && openedMemories.size === memories.length;
                if (isLastMemoryOpen) {
                    return; // Do nothing, keep the window open
                }
                closeAllWindows();
            }
        });

        function closeAllWindows() {
            if (memoryPopup.style.display === 'block') {
                hideMemoryPopup();
            }
            if (finalPopup.style.display === 'block') {
                hideFinalPopup();
            }
        }
        
        function hideMemoryPopup() {
            memoryPopup.style.display = 'none';
            document.querySelector(`.taskbar-tab[data-memory-id="${memoryPopup.dataset.memoryId}"]`)?.classList.remove('active');
            checkUnlockCondition();
        }

        function hideFinalPopup() {
            finalPopup.style.display = 'none';
            stopLyricEngine();
            if (soundcloudWidget) {
                soundcloudWidget.pause();
            }
            if (!isVideoIconCreated) {
                createVideoReopenIcon();
            }
        }
        
        let isDesktopInitialized = false;
        let memories = [];
        let openedMemories = new Set();
        let isVideoIconCreated = false;

        let draggedIcon = null;
        let didMove = false;
        
        function initializeDesktop() {
            if (isDesktopInitialized) return;
            isDesktopInitialized = true;
            
            const clockElement = document.getElementById('clock');
            const startButton = document.querySelector('.start-button');
            memories = [
                { id: 1, title: "The Ask", text: "<p>We were in the cinema<br>I wasn't watching the film<br> I was watching my hand</p><p>I wasn't sure if I could hold your hand<br>I didn't know if I had the right<br>But I wanted to feel your hand<br> just once</p><p>I waited, hesitated, then tried<br>And when you didn't pull away<br>that moment, right before our fingers touched<br>felt like the beginning of something I'd been waiting for</p>", visual: `<img src="https://raw.githubusercontent.com/Amine4332/manal/refs/heads/main/Untitpled-2.png" alt="The Ask">`, position: { top: '30%', left: '10%' } },
                { id: 2, title: "Same Screen", text: "<p>We watched so many movies together<br>two screens, one moment<br>You were far, but somehow… I felt close</p><p>It felt like you were sitting right beside me<br>I remember your messages more than the scenes<br>Your words made the silence feel warm</p><p>I kept waiting for your thoughts<br>feeling like time paused<br>just to let us exist in the same dream</p><p>Those nights, I didn't fall for the movie<br>I fell for you</p>", visual: `<img src="https://raw.githubusercontent.com/Amine4332/manal/refs/heads/main/Untitlegdd-2.png" alt="Same Screen">`, position: { top: '55%', left: '85%' } },
                { id: 3, title: "7olm", text: "<p>You sent me a voice note<br>Singing<br>Not loud. Not perfect<br>But your voice felt like it knew where my heart was</p><p>It didn't just carry the song<br>it carried a piece of you<br>In that moment<br>I didn't hear a song<br>I heard something softer</p><p>My chest tightened<br>Tears came, no reason needed<br>I felt love<br>The quiet kind<br>The real kind</p>", visual: `<img src="https://raw.githubusercontent.com/Amine4332/manal/refs/heads/main/Untitdled-2.png" alt="7olm">`, position: { top: '50%', left: '30%' } },
                { id: 4, title: "Jp Kat3jbini", text: "<p>I don't remember the movie<br>I only remember the message I sent<br>\"Jp kat3jbini\"</p><p>It was quiet. Simple. Almost shy<br>But in that moment<br>everything paused<br>the screen, the sound, my thoughts</p><p>That line was my way of saying<br>\"I'm already yours\"<br>without saying too much</p><p>And when you answered...<br>I knew something had started<br>something we never named<br>but both felt</p>", visual: `<img src="https://raw.githubusercontent.com/Amine4332/manal/refs/heads/main/Untitledfr-2.png" alt="Jp Kat3jbini">`, position: { top: '75%', left: '40%' } },
                { id: 5, title: "Reflection in Your Eyes", text: "<p>I remember the cinema lights on your face<br>The screen glowing in your eyes<br>I wasn't watching the movie anymore<br>I was watching the reflection in your eyes</p><p>The way you looked at the screen<br>so focused, so soft<br>it made me feel like I was inside the story</p><p>That moment wasn't loud<br>But it stayed<br>Like your eyes had recorded it for me</p>", visual: `<img src="https://raw.githubusercontent.com/Amine4332/manal/refs/heads/main/Untsditled-2.png" alt="Reflection in Your Eyes">`, position: { top: '80%', left: '15%' } },
                { id: 6, title: "Our List", text: "<p>We'll keep adding to it<br>Little things we dream up together<br>A place to go<br>A meal to cook</p><p>It won't be perfect<br>But it'll be ours</p><p>One day, we'll look at that list<br>and realize we didn't just write plans<br>we wrote a life</p>", visual: `<img src="https://raw.githubusercontent.com/Amine4332/manal/refs/heads/main/Undtitdled-2.png" alt="Our List">`, position: { top: '40%', left: '60%' } },
                { id: 7, title: "Holding Hands", text: "<p>We held hands through the whole movie<br>Not just for a moment<br>No tension. No fear<br>Just warmth, stillness, and you</p><p>I don't remember what the film was about<br>But I remember how still your hand felt in mine<br>That silence between our fingers<br>said more than anything we could've spoken</p>", visual: `<img src="https://raw.githubusercontent.com/Amine4332/manal/refs/heads/main/Untitledd-2.png" alt="Holding Hands">`, position: { top: '65%', left: '70%' } },
                { id: 8, title: "First Date", text: "<p>Our first real moment<br>Not a screen. Not a message<br>Just you. Just me</p><p>We met at the cinema<br>But I wasn't nervous about the movie<br>I was nervous about seeing you<br>for real</p><p>I remember how you looked<br>What you wore<br>The way you smiled when you saw me</p><p>That day, I knew<br><br>This was the beginning of something real</p>", visual: `<img src="https://raw.githubusercontent.com/Amine4332/manal/refs/heads/main/Ungttitled-2.png" alt="First Date">`, position: { top: '25%', left: '75%' } }
            ];
            
            startButton.addEventListener('click', () => { window.location.reload(); });

            function updateClock() {
                const now = new Date(); let hours = now.getHours();
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const ampm = hours >= 12 ? 'PM' : 'AM'; hours = hours % 12; hours = hours ? hours : 12;
                clockElement.textContent = `${hours}:${minutes} ${ampm}`;
            }
            setInterval(updateClock, 1000); updateClock();

            memories.forEach(memory => { createIcon(memory); });
            initializeSoundCloudPlayer();
        }
        
        function addDragListeners(iconDiv) {
            iconDiv.addEventListener('mousedown', dragStart);
            iconDiv.addEventListener('touchstart', dragStart, { passive: true });
        }
        
        function createIcon(memory, isSpecialVideoIcon = false) {
            const iconsContainer = document.getElementById('desktop-icons-container');
            const iconDiv = document.createElement('div');
            
            if (isSpecialVideoIcon) {
                iconDiv.className = 'desktop-icon starlight-materialize';
                iconDiv.style.top = '75%';
                iconDiv.style.left = '50%';
                iconDiv.style.transform = 'translateX(-50%)';
            } else {
                iconDiv.className = 'desktop-icon';
                iconDiv.style.top = memory.position.top;
                iconDiv.style.left = memory.position.left;
                
                const animations = ['float1', 'float2', 'float3', 'float4', 'float5', 'float6'];
                const timings = ['ease', 'ease-in-out', 'linear'];
                const directions = ['normal', 'reverse'];
                const randomAnimationName = animations[Math.floor(Math.random() * animations.length)];
                const randomDuration = Math.random() * 20 + 15;
                const randomTiming = timings[Math.floor(Math.random() * timings.length)];
                const randomDirection = directions[Math.floor(Math.random() * directions.length)];
                iconDiv.style.animationName = randomAnimationName;
                iconDiv.style.animationDuration = `${randomDuration}s`;
                iconDiv.style.animationTimingFunction = randomTiming;
                iconDiv.style.animationDirection = randomDirection;
            }
            
            iconDiv.innerHTML = `<div class="icon-visual">${memory.visual}</div><div class="icon-label">${memory.title}</div>`;
            iconDiv.dataset.memoryId = memory.id;
            
            addDragListeners(iconDiv);
            
            iconsContainer.appendChild(iconDiv);
        }

        function dragStart(e) {
            draggedIcon = e.target.closest('.desktop-icon');
            if (!draggedIcon) return;
            didMove = false;
            const event = e.touches ? e.touches[0] : e;
            const rect = draggedIcon.getBoundingClientRect();
            dragOffsetX = event.clientX - rect.left;
            dragOffsetY = event.clientY - rect.top;
            draggedIcon.classList.add('dragging');
        }

        function dragMove(e) {
            if (!draggedIcon) return;
            e.preventDefault(); 
            didMove = true;
            const event = e.touches ? e.touches[0] : e;
            let newX = event.clientX - dragOffsetX;
            let newY = event.clientY - dragOffsetY;
            draggedIcon.style.left = `${newX}px`;
            draggedIcon.style.top = `${newY}px`;
        }

        function dragEnd() {
            if (!draggedIcon) return;
            draggedIcon.classList.remove('dragging');
            if (!didMove) {
                const memoryId = parseInt(draggedIcon.dataset.memoryId);
                if (memoryId === 99) {
                    showFinalPopup();
                } else {
                    const memory = memories.find(m => m.id === memoryId);
                    if (memory) { openMemoryPopup(memory); }
                }
            }
            draggedIcon = null;
        }
        
        document.addEventListener('mousemove', dragMove);
        document.addEventListener('touchmove', dragMove, { passive: false });
        document.addEventListener('mouseup', dragEnd);
        document.addEventListener('touchend', dragEnd);

        function openMemoryPopup(memory) {
            closeAllWindows();
            memoryPopup.style.display = 'block';
            memoryPopup.dataset.memoryId = memory.id;
            document.getElementById('popup-title').textContent = memory.title;
            document.getElementById('popup-text').innerHTML = memory.text;
            memoryPopup.querySelector('.popup-visual').innerHTML = memory.visual;
            openedMemories.add(memory.id);

            let tab = document.querySelector(`.taskbar-tab[data-memory-id="${memory.id}"]`);
            if (!tab) {
                tab = document.createElement('div');
                tab.className = 'taskbar-tab';
                tab.dataset.memoryId = memory.id;
                tab.innerHTML = `<div class="icon-visual">${memory.visual}</div>`;
                tab.addEventListener('click', (e) => { e.stopPropagation(); openMemoryPopup(memory); });
                document.getElementById('taskbar-windows').appendChild(tab);
            }
            
            document.querySelectorAll('.taskbar-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
        }

        function showFinalPopup() {
            closeAllWindows();
            finalPopup.style.display = 'block';
            startLyricEngine();
            if (soundcloudWidget) {
                soundcloudWidget.play();
            }
        }
        
        memoryPopup.querySelector('.close-button').addEventListener('click', hideMemoryPopup);
        finalPopup.querySelector('.close-button').addEventListener('click', hideFinalPopup);

        function checkUnlockCondition() {
            if (!isVideoIconCreated && openedMemories.size === memories.length) {
                 setTimeout(() => {
                    showFinalPopup();
                 }, 300); // Delay to ensure smooth UI transition
            }
        }
        
        function createVideoReopenIcon() {
            if (isVideoIconCreated) return;
            isVideoIconCreated = true;
            const videoMemory = { 
                id: 99, 
                title: "Our Video", 
                visual: `<img src="https://raw.githubusercontent.com/Amine4332/manal/refs/heads/main/Untitlefd-2.png" alt="Our Video">`
            };
            createIcon(videoMemory, true);
        }

        // --- SOUNDCLOUD LYRIC ENGINE ---
        const lyrics = [
            { start: 19.2, end: 20.2, text: "قبلِك" }, { start: 21.5, end: 25.0, text: "أنا ماكنتش ... كنت متحف مهجور" }, { start: 27.0, end: 34.5, text: "كل اللي فيه قيّم، بس الصمت كان هو الغبار" }, { start: 37.0, end: 40.5, text: "كنت الكلام اللي محبوس في الكتب" }, { start: 41.0, end: 44.0, text: "مستني حد... مش عشان يقرا" }, { start: 47.0, end: 51.5, text: "عشان بصوابعه، يحس الغبار" }, { start: 56.0, end: 59.5, text: "دخلنا مكان مليان حكايات" }, { start: 61.0, end: 64.0, text: "بس أنا كنت مستني حكايتي" }, { start: 65.5, end: 71.0, text: "النور اللي على الشاشة كان أعمى، مجرد ألوان بتجري" }, { start: 73.0, end: 76.5, text: "لحد ما شفت انعكاسه في عنيكي" }, { start: 80.0, end: 82.5, text: "وقتها بس، بقى للضوء معنى" }, { start: 83.5, end: 86.5, text: "كل المشاهد بقت حقيقية" }, { start: 88.5, end: 91.0, text: "عشان شوفتها في مكان صادق" }, { start: 92.5, end: 98.5, text: "وهناك، ماتفرجتش على فيلم... أنا شفت النور وهو بيلاقيني فيكي" }, { start: 99.5, end: 104.0, text: "البطل على الشاشة بيجري... وأنا شايف انعكاسه فيكي" }, { start: 105.0, end: 112.0, text: "قصته بتموت وتخلص... وقصتنا بتبدأ بعنيكي" }, { start: 116.0, end: 118.0, text: "ولما إيدي لمست إيدك" }, { start: 118.5, end: 122.0, text: "ده ماكانش إحساس... ده كان يقين" }, { start: 123.0, end: 127.5, text: "كل الضجيج اللي في راسي سكت فجأة" }, { start: 128.5, end: 135.0, text: "والنبض الخفيف اللي في إيدينا... بقى أعلى من كل الأصوات" }, { start: 136.5, end: 138.0, text: "ماكنتش بحلم" }, { start: 138.5, end: 142.5, text: "لأ، أنا كنت بصحى لأول مرة في حياتي" }, { start: 143.0, end: 147.5, text: "كل نظرة منك، ماكنتش بتقول \"أنا جنبك\"" }, { start: 148.0, end: 151.0, text: "كانت بتأكدلي إنك جنبي" }, { start: 151.5, end: 154.0, text: "ماكنتيش بتحاولي تفهميني" }, { start: 155.5, end: 159.0, text: "كنتي بتسمعي للصمت اللي بين الكلام" }, { start: 160.5, end: 163.0, text: "ماكنتيش بطلة بتنقذني" }, { start: 163.5, end: 172.5, text: "كنتي القارئة الوحيدة اللي عرفت... إن أجمل الحكايات بتبدأ من صفحة مهجورة" }, { start: 175.5, end: 177.5, text: "بس قلبي كان خايف" }, { start: 181.5, end: 183.0, text: "مش منها، منها لأ" }, { start: 184.0, end: 184.5, text: "منّي" }, { start: 185.0, end: 188.0, text: "خايف أكون شايف فيها طوق نجاة" }, { start: 189.0, end: 190.5, text: "مش لأنها هي" }, { start: 191.5, end: 193.5, text: "لكن علشان أنا غرقان" }, { start: 196.0, end: 198.5, text: "كل حاجة فيها كانت حقيقية" }, { start: 199.0, end: 203.5, text: "ضحكتها، سكوتها، حتى الشرود اللي في عينيها" }, { start: 205.5, end: 207.5, text: "كان في صدق بيخوفني" }, { start: 208.0, end: 212.0, text: "لأني كنت ناسي يعني إيه حد يكون صادق" }, { start: 213.0, end: 214.5, text: "هل أنا بحبها؟" }, { start: 215.0, end: 218.5, text: "ولا بحب إحساس الأمان اللي جه معاها؟" }, { start: 219.0, end: 220.5, text: "هل هي منال" }, { start: 221.0, end: 223.5, text: "ولا هي المراية اللي شفت فيها نفسي" }, { start: 224.0, end: 225.5, text: "من غير أقنعة؟" }, { start: 228.5, end: 230.0, text: "وفجأة في عز الفيلم" }, { start: 230.5, end: 235.0, text: "وصلت لإجابة سؤال، عمري ما عرفت أسأله" }, { start: 236.5, end: 241.5, text: "هل بحبها، ولا بحب فكرة إني ما بقتش وحيد؟" }, { start: 242.5, end: 245.5, text: "الإجابة كانت في دفى إيدك" }, { start: 247.0, end: 255.5, text: "اللي ماكانش بيطمني، كان بيخليني شجاع كفاية إني ما أخافش من السؤال" }, { start: 259.5, end: 265.0, text: "وفجأة... من غير ترتيب... ومن غير أي كلام" }, { start: 266.5, end: 271.0, text: "لقيت صوتي بيقول \"بحبك\"... كإنه إعلان" }, { start: 272.5, end: 278.0, text: "إعلان لكل الدنيا... إن خلاص لقيت مكاني" }, { start: 278.5, end: 284.5, text: "وإن الحب مش محتاج فرصة... الحب بيصنع زمانه" }, { start: 292.0, end: 294.0, text: "ولما إيدي لمست إيدك" }, { start: 294.5, end: 298.0, text: "ده ماكانش إحساس... ده كان يقين" }, { start: 299.0, end: 304.0, text: "كل الضجيج اللي في راسي سكت فجأة" }, { start: 305.5, end: 311.5, text: "والنبض الخفيف اللي في إيدينا... بقى أعلى من كل الأصوات" }, { start: 312.5, end: 314.0, text: "ماكنتش بحلم" }, { start: 315.0, end: 318.5, text: "لأ، أنا كنت بصحى لأول مرة في حياتي" }, { start: 319.5, end: 322.0, text: "ولما النور قاد فجأة" }, { start: 322.5, end: 327.0, text: "ماكانش نهاية الحلم... كان بداية تصديقه" }, { start: 327.5, end: 332.5, text: "النور اللي طول عمري بهرب منه، بقى صديق" }, { start: 333.0, end: 338.5, text: "قمنا، وإيدينا لسه ماسكين في بعض بنفس القوة" }, { start: 339.5, end: 342.0, text: "وإحنا طالعين على السلم" }, { start: 343.0, end: 348.0, text: "كانت أول خطوة في حكاية... لسه بخاف أصدقها" }, { start: 348.5, end: 350.5, text: "مش نهاية فيلم" }, { start: 352.5, end: 379.0, text: "دي كانت بداية كل حاجة" }, { start: 379.5, end: 1000.0, text: "kanbghik 💕" }
        ];

        let soundcloudWidget;
        let lyricInterval;

        function startLyricEngine() {
            if (lyricInterval) clearInterval(lyricInterval); // Clear any existing interval
            
            const lyricDisplay = document.getElementById('lyric-display');
            const progressBarFill = document.querySelector('.progress-bar-fill');
            const currentTimeEl = document.getElementById('current-time');
            const totalDurationEl = document.getElementById('total-duration');
            let totalDuration = 0;
            let currentLyric = '';

            soundcloudWidget.getDuration((duration) => {
                totalDuration = duration / 1000;
                totalDurationEl.textContent = formatTime(totalDuration);
            });

            lyricInterval = setInterval(() => {
                if (!soundcloudWidget || !totalDuration) return;
                soundcloudWidget.getPosition((position) => {
                    const currentTime = position / 1000;
                    
                    currentTimeEl.textContent = formatTime(currentTime);
                    const progressPercent = (currentTime / totalDuration) * 100;
                    progressBarFill.style.width = `${progressPercent}%`;

                    const activeLyric = lyrics.find(lyric => currentTime >= lyric.start && currentTime <= lyric.end);
                    if (activeLyric) {
                        if (currentLyric !== activeLyric.text) {
                            currentLyric = activeLyric.text;
                            lyricDisplay.innerHTML = `<span class="lyric-line">${currentLyric}</span>`;
                        }
                    } else if (currentLyric !== '') {
                        currentLyric = '';
                        lyricDisplay.innerHTML = '';
                    }
                });
            }, 100);
        }

        function stopLyricEngine() {
            if (lyricInterval) {
                clearInterval(lyricInterval);
                lyricInterval = null;
            }
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs.toString().padStart(2, '0')}`;
        }
        
        function initializeSoundCloudPlayer() {
            const playerContainer = document.getElementById('soundcloud-player-container');
            const trackUrl = 'https://soundcloud.com/amine-elmoufid-642633107/hbd_1';
            const iframe = document.createElement('iframe');
            iframe.style.width = '100%';
            iframe.id = 'sc-widget';
            iframe.allow = "autoplay";
            iframe.src = `https://w.soundcloud.com/player/?url=${encodeURIComponent(trackUrl)}`;
            playerContainer.appendChild(iframe);

            soundcloudWidget = SC.Widget(iframe);
            const playPauseBtn = document.getElementById('play-pause-button');
            const progressBar = document.querySelector('.progress-bar');
            let totalDurationMs = 0;
            
            soundcloudWidget.bind(SC.Widget.Events.READY, () => {
                soundcloudWidget.getDuration((duration) => {
                    totalDurationMs = duration;
                    document.getElementById('total-duration').textContent = formatTime(duration / 1000);
                });
            });

            playPauseBtn.addEventListener('click', () => {
                soundcloudWidget.toggle();
            });

            soundcloudWidget.bind(SC.Widget.Events.PLAY, () => {
                playPauseBtn.textContent = '❚❚';
                playPauseBtn.classList.add('playing');
                startLyricEngine();
            });

            soundcloudWidget.bind(SC.Widget.Events.PAUSE, () => {
                playPauseBtn.textContent = '►';
                playPauseBtn.classList.remove('playing');
                stopLyricEngine();
            });

            soundcloudWidget.bind(SC.Widget.Events.FINISH, () => {
                playPauseBtn.textContent = '►';
                playPauseBtn.classList.remove('playing');
                stopLyricEngine();
            });

            progressBar.addEventListener('click', function(e) {
                const rect = this.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const percentage = clickX / rect.width;
                if(totalDurationMs > 0) {
                    soundcloudWidget.seekTo(percentage * totalDurationMs);
                }
            });
        }
    });
    </script>
</body>
</html>